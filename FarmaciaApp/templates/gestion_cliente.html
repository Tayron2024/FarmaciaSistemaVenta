{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interfaz de Cliente - Farmacia SanaSana</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: url("https://previews.123rf.com/images/wararat2599/wararat25992311/wararat2599231103693/218781620-un-concepto-de-farmac%C3%A9utico-y-medicina-de-farmacia-fondo-borroso.jpg") no-repeat center center fixed;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        header {
            width: 100%;
            background: rgba(0, 123, 255, 0.9);
            color: white;
            padding: 15px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
        }

        nav {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            margin: 20px;
        }

        h2 {
            color: #007BFF;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .card img {
            max-width: 100%;
            border-radius: 10px;
        }

        .card h2 {
            font-size: 20px;
            margin: 10px 0;
        }

        .card p {
            font-size: 14px;
            color: #555;
        }

        .card .stock {
            font-weight: bold;
            color: #28a745;
        }

        .card input {
            width: 80%;
            padding: 5px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .card button {
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: 0.3s;
        }

        .card button:hover {
            background: #218838;
        }

        .cart {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }

        .cart h3 {
            color: #007BFF;
            margin-bottom: 15px;
        }

        .cart ul {
            list-style: none;
            padding: 0;
        }

        .cart ul li {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart ul li .info {
            flex: 1;
            text-align: left;
        }

        .cart ul li .info .nombre {
            font-weight: bold;
        }

        .cart ul li .info .precio-unitario {
            color: #555;
            font-size: 14px;
        }

        .cart ul li .info .subtotal {
            font-weight: bold;
            color: #28a745;
        }

        .cart ul li button {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.3s;
        }

        .cart ul li button:hover {
            background: #c82333;
        }

        .cart .total {
            font-weight: bold;
            font-size: 18px;
            margin-top: 15px;
            text-align: right;
        }

        .cart .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .cart .button-group button {
            background: #007BFF;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            flex: 1;
        }

        .cart .button-group button:hover {
            opacity: 0.9;
        }

        footer {
            width: 100%;
            background: rgba(0, 123, 255, 0.9);
            color: white;
            padding: 10px;
            position: absolute;
            bottom: 0;
            text-align: center;
        }

        /* Estilo para el botón de WhatsApp */
        .whatsapp-button {
            background: #25D366;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            margin-top: 20px;
        }

        .whatsapp-button:hover {
            background: #128C7E;
        }
    </style>
</head>
<body>
    <header>
        Farmacia SanaSana
        <nav>
            <a href="/home/">Cerrar Sesión</a>
        </nav>
    </header>

    <main class="container">
        <h2>Explora los diversos medicamentos</h2>
        <p>Explore nuestra selección de medicamentos a continuación:</p>

        <div class="grid" id="productos">
            <!-- Los productos se cargarán dinámicamente desde localStorage -->
        </div>

        <div class="cart" id="carrito">
            <h3>Carrito de Compras</h3>
            <ul id="lista-carrito"></ul>
            <div class="total" id="total-carrito">Total: $0</div>
            <div class="button-group">
                <button onclick="irAPago()">Ir al Método de Pago</button>
                <button class="reiniciar" onclick="reiniciarCarrito()">Reiniciar Carrito</button>
            </div>
        </div>

        <!-- Botón de WhatsApp -->
        <button class="whatsapp-button" onclick="redirigirAWhatsApp()">Chatear por WhatsApp</button>
    </main>

    <script>
        // Cargar datos del inventario desde localStorage
        const datosFarmacia = JSON.parse(localStorage.getItem("datosFarmacia")) || {
            productos: [
                { nombre: "Ibuprofeno", cantidad: 150, precio: 2.50, imagen: "https://www.lasanteca.com/userfiles/2018/12/IBUPROFENO-600MG-CAJA-POR-50-TABLETAS-CON-BLISTER.jpg" },
                { nombre: "Paracetamol", cantidad: 200, precio: 2.50, imagen: "https://boticasperu.pe/media/catalog/product/cache/eebfcecb9382e8d5ccf71e8b2c8cbd30/9/3/9342026280.jpg" },
                { nombre: "Amoxicilina", cantidad: 100, precio: 5.00, imagen: "https://www.lasanteca.com/userfiles/2018/12/AMOXICILINA-250MG-5ML-SUSPENCI%E2%80%A1N-100ML-CON-FRASCO.jpg" },
                { nombre: "Naproxeno", cantidad: 180, precio: 4.00, imagen: "https://mispastillas.com/wp-content/uploads/2021/05/1201-Naproxeno-500-mg-x-10-tab-GENFAR-mispastillas-tienda-pastillas-medellin-colombia.jpg" },
                { nombre: "Loratadina", cantidad: 250, precio: 3.00, imagen: "https://www.lasanteca.com/userfiles/2018/12/LORATADINA-10MG-CAJA-POR-10-TABLETAS-CON-BLISTER.jpg" },
                { nombre: "Omeprazol", cantidad: 120, precio: 6.00, imagen: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_ncpDSgVh_ysSIiRYOl2TmrgyDDumEi54-g&s" },
            ],
        };

        // Inicializar el carrito desde localStorage
        let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

        // Función para cargar los productos en la interfaz
        function cargarProductos() {
            const productosContainer = document.getElementById("productos");
            productosContainer.innerHTML = "";

            datosFarmacia.productos.forEach((producto, index) => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                    <img src="${producto.imagen}" alt="${producto.nombre}">
                    <h2>${producto.nombre}</h2>
                    <p>${producto.descripcion || "Descripción no disponible"}</p>
                    <p class="stock">Stock disponible: ${producto.cantidad} unidades</p>
                    <p class="precio">Precio unitario: $${producto.precio.toFixed(2)}</p>
                    <input type="number" min="1" value="1" id="cantidad-${index}">
                    <button onclick="agregarAlCarrito('${producto.nombre}', ${producto.precio}, 'cantidad-${index}')">Añadir al Carrito</button>
                `;
                productosContainer.appendChild(card);
            });
        }

        // Función para agregar productos al carrito
        function agregarAlCarrito(producto, precio, inputId) {
            const cantidad = parseInt(document.getElementById(inputId).value);
            const subtotal = precio * cantidad;

            // Verificar si hay suficiente stock
            const productoEnInventario = datosFarmacia.productos.find(p => p.nombre === producto);
            if (productoEnInventario && productoEnInventario.cantidad < cantidad) {
                alert("No hay suficiente stock disponible.");
                return;
            }

            // Agregar al carrito
            const productoEnCarrito = carrito.find(item => item.producto === producto);
            if (productoEnCarrito) {
                productoEnCarrito.cantidad += cantidad;
                productoEnCarrito.subtotal += subtotal;
            } else {
                carrito.push({ producto, cantidad, precio, subtotal });
            }

            // Actualizar el stock en el inventario
            productoEnInventario.cantidad -= cantidad;
            localStorage.setItem("datosFarmacia", JSON.stringify(datosFarmacia));

            // Guardar el carrito y actualizar la interfaz
            localStorage.setItem("carrito", JSON.stringify(carrito));
            actualizarCarrito();
            cargarProductos(); // Actualizar el stock en la interfaz
        }

        // Función para actualizar el carrito en la interfaz
        function actualizarCarrito() {
            const listaCarrito = document.getElementById("lista-carrito");
            const totalCarrito = document.getElementById("total-carrito");
            listaCarrito.innerHTML = "";

            let total = 0;
            carrito.forEach((item, index) => {
                total += item.subtotal;
                const li = document.createElement("li");
                li.innerHTML = `
                    <div class="info">
                        <div class="nombre">${item.producto}</div>
                        <div class="precio-unitario">Precio unitario: $${item.precio.toFixed(2)}</div>
                        <div class="subtotal">Subtotal: $${item.subtotal.toFixed(2)}</div>
                    </div>
                    <button onclick="eliminarDelCarrito(${index})">Eliminar</button>
                `;
                listaCarrito.appendChild(li);
            });

            totalCarrito.textContent = `Total: $${total.toFixed(2)}`;
            localStorage.setItem("totalCompra", total.toFixed(2)); // Guardar el total en localStorage
        }

        // Función para eliminar un producto del carrito
        function eliminarDelCarrito(index) {
            const item = carrito[index];
            const productoEnInventario = datosFarmacia.productos.find(p => p.nombre === item.producto);

            // Devolver la cantidad al inventario
            if (productoEnInventario) {
                productoEnInventario.cantidad += item.cantidad;
                localStorage.setItem("datosFarmacia", JSON.stringify(datosFarmacia));
            }

            // Eliminar del carrito
            carrito.splice(index, 1);
            localStorage.setItem("carrito", JSON.stringify(carrito));
            actualizarCarrito();
            cargarProductos(); // Actualizar el stock en la interfaz
        }

        // Función para reiniciar el carrito
        function reiniciarCarrito() {
            if (confirm("¿Estás seguro de que deseas vaciar el carrito?")) {
                carrito.forEach(item => {
                    const productoEnInventario = datosFarmacia.productos.find(p => p.nombre === item.producto);
                    if (productoEnInventario) {
                        productoEnInventario.cantidad += item.cantidad;
                    }
                });

                carrito = [];
                localStorage.setItem("carrito", JSON.stringify(carrito));
                localStorage.setItem("datosFarmacia", JSON.stringify(datosFarmacia));
                actualizarCarrito();
                cargarProductos(); // Actualizar el stock en la interfaz
            }
        }

        // Función para redirigir a WhatsApp
        function redirigirAWhatsApp() {
            const phoneNumber = "+5930998026172"; // Reemplaza con tu número de WhatsApp
            const message = "Hola, necesito ayuda con mi pedido."; // Mensaje predeterminado
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        // Función para redirigir a la página de pago
        function irAPago() {
            if (carrito.length === 0) {
                alert("El carrito está vacío. Agrega productos antes de pagar.");
            } else {
                // Redirigir a la página de pago
                window.location.href = "/pago/";
            }
        }

        // Cargar productos al iniciar la página
        cargarProductos();
        actualizarCarrito();
    </script>
</body>
</html>